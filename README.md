# Security Log Triage Agent

### ðŸ”Ž Evaluator Highlights
- **Modular pipeline**: Parsing â†’ Grouping â†’ Scoring â†’ Reporting, each step transparent and logged.  
- **Observability**: Full INFO/DEBUG logs, severity breakdowns, and average score metrics.  
- **AI Integration**: Highâ€‘severity incidents enriched with Gemini naturalâ€‘language explanations.  
- **Evaluatorâ€‘ready**: Sample input (`data/input/logs.csv`) and output (`output/report.md`) included for quick verification.  

---

## ðŸ“Œ Overview
This project implements a lightweight **security log triage pipeline**.  
It ingests raw log events, groups them into incidents, applies scoring heuristics, and generates a Markdown report with severity breakdowns and recommendations.

The pipeline demonstrates:
- âœ… Parsing structured logs into event objects  
- âœ… Incident grouping by key fields (action, host, user, IP, time bucket)  
- âœ… Scoring incidents with simple heuristics (failed logins, admin targeting, port scans, suspicious IPs)  
- âœ… Reporting with summary stats, top incidents, and recommendations  
- âœ… Observability via logging and metrics  
- ðŸŒŸ **Gemini Integration**: Highâ€‘severity incidents include naturalâ€‘language explanations generated by Google Gemini, enriching numeric scores with AIâ€‘powered narrative context  

---

## âš™ï¸ Setup

### 1. Clone the repository
```bash
git clone https://github.com/devPaulX/security-log-triage-agent.git
cd security-log-triage-agent
```

### 2. Create a virtual environment
```bash
python -m venv .venv
```

Activate it:
- Windows:
  ```bash
  .\.venv\Scripts\activate
  ```
- Linux/Mac:
  ```bash
  source .venv/bin/activate
  ```

### 3. Install dependencies
```bash
pip install -r requirements.txt
```

### 4. Configure Gemini API Key
Obtain an API key from Google AI Studio and set it as an environment variable:

```markdown
## ðŸ”‘ Gemini API Setup
Set your API key before running:
- Windows (PowerShell): `$env:GOOGLE_API_KEY="your-api-key"`
- Linux/Mac: `export GOOGLE_API_KEY="your-api-key"`

> âš ï¸ Keys are **never hardâ€‘coded** in source files. This ensures security and portability.
```

---

## ðŸš€ Usage

Run the triage pipeline with the included sample input:

```powershell
python -m src.cli data/input/logs.csv --output output/report.md
```

### Example Output
- Input: `data/input/logs.csv` (sample synthetic logs provided)  
- Output: `output/report.md` (Markdown triage report with Gemini explanations for highâ€‘severity incidents)  

---

## ðŸ“Š Observability

The pipeline includes logging and metrics:
- Logs each step (`events loaded`, `incidents grouped`, `incidents scored`, `report generated`).  
- Metrics logged:
  - Total events
  - Total incidents
  - Severity breakdown
  - Average incident score

Example log output:
```
2025-12-01 23:30:00 [INFO] Step 1 complete: Events loaded
2025-12-01 23:30:00 [INFO] Step 2 complete: Incidents grouped
2025-12-01 23:30:00 [INFO] Step 3 complete: Incidents scored
2025-12-01 23:30:00 [INFO] Average incident score: 4.25
2025-12-01 23:30:00 [INFO] Step 4 complete: Report generated
2025-12-01 23:30:00 [INFO] Total events: 50
2025-12-01 23:30:00 [INFO] Total incidents: 12
2025-12-01 23:30:00 [INFO] Severity breakdown: {'low': 5, 'medium': 4, 'high': 3}
2025-12-01 23:30:00 [INFO] Step 5 complete: Report saved to output/report.md
```

---

## ðŸ“‚ Project Structure
```
security-log-triage-agent/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ cli.py          # CLI entry point
â”‚   â”œâ”€â”€ parser.py       # Load events from CSV
â”‚   â”œâ”€â”€ dedupe.py       # Group events into incidents
â”‚   â”œâ”€â”€ score.py        # Apply scoring heuristics + Gemini integration
â”‚   â”œâ”€â”€ report.py       # Generate and render report (includes Gemini explanations)
â”‚   â””â”€â”€ models.py       # Core data models
â”œâ”€â”€ data/input/logs.csv # Sample input logs
â”œâ”€â”€ output/report.md    # Sample output report
â”œâ”€â”€ requirements.txt    # Dependencies
â””â”€â”€ .gitignore          # Git hygiene
```

---

## ðŸ“‘ Sample Output Snippet
To help evaluators quickly verify Gemini integration, hereâ€™s an excerpt from `output/report.md`:
### Incident login_failed|server3|admin|198.51.100.23|2025-11-30 10:10
- Action: login_failed
- Host: server3
- User: admin
- IP: 198.51.100.23
- Count: 2
- Severity: high
- Evidence: ['Failed login attempt', 'Failed login attempt'] ...
- Gemini Explanation: This incident is highly risky due to the combination of several critical factors:
  - Targeting the `admin` account (highest privileges).
  - Multiple failed login attempts suggest probing or brute-force.
  - External IP origin indicates likely unauthorized access.


```markdown
### Incident login_failed|server3|admin|198.51.100.23|2025-11-30 10:10
- Action: login_failed
- Host: server3
- User: admin
- IP: 198.51.100.23
- Count: 2
- Severity: high
- Evidence: ['Failed login attempt', 'Failed login attempt'] ...
- Gemini Explanation: This incident is highly risky due to the combination of several critical factors:
  - Targeting the `admin` account (highest privileges).
  - Multiple failed login attempts suggest probing or brute-force.
  - External IP origin indicates likely unauthorized access.
```

---

## ðŸ§­ Notes for Evaluators
- Sample input (`logs.csv`) and output (`report.md`) are included for quick verification.  
- Logging ensures transparency of pipeline execution.  
- The design is modular, making it easy to extend with new rules or integrations.  
- ðŸŒŸ **Bonus Feature:** Gemini explanations enrich highâ€‘severity incidents, demonstrating effective use of AI for contextual triage.  

---

## ðŸ›  Developer Utilities
These helper scripts are included for debugging and validation:

- `scripts/list_models.py`: Lists all Gemini models available to your API key, including supported methods.  
- `scripts/test_gemini.py`: Sends a sample prompt to Gemini to verify API connectivity and model response.  

> These are **not part of the main triage pipeline** but demonstrate setup and troubleshooting steps.

## ðŸ“„ License

This project is licensed under the [MIT License](LICENSE).  
You are free to use, modify, and distribute it with attribution.
